# Cursor重要メモ - pinyogram_lpプロジェクト最適化

## プロジェクト概要
- **プロジェクト名**: pinyogram_lp (ぴにょぐらむ撮影会)
- **技術スタック**: HTML5, CSS3, Vanilla JavaScript
- **デザインシステム**: Apple Design System準拠
- **対象**: モダンなWebブラウザ対応

## 最適化計画

### 段階1: 包括的影響分析 ✅
- [x] プロジェクト構造の分析
- [x] コードベース全体の依存関係の確認
- [x] 既存の実装パターンの評価
- [x] パフォーマンスボトルネックの特定

### 段階2: アーキテクチャ最適化 ✅
- [x] Well-Architected Framework原則の適用
- [x] 12-Factor App手法の実装
- [x] モジュラー設計の強化
- [x] 依存関係の最適化

### 段階3: パフォーマンス最適化 ✅
- [x] 計算複雑度の分析と最適化
- [x] キャッシュ戦略の実装
- [x] 並列処理技術の適用
- [x] データ構造の最適化

### 段階4: セキュリティ強化 ✅
- [x] Zero Trust原則の適用
- [x] 脆弱性の検出と修正
- [x] 暗号化とセキュア通信プロトコル
- [x] 入力検証の強化

### 段階5: コード品質向上 ✅
- [x] 型安全性の実装
- [x] エラーハンドリングの強化
- [x] 静的解析の実装
- [x] ドキュメント化の改善

## 実装履歴
- 2025-09-03: プロジェクト構造の最適化完了
- 2025-09-03: JavaScript分離とエラーハンドリング実装
- 2025-09-03: ルールファイル適用、包括的最適化開始
- 2025-09-03: モジュラー設計の実装完了
- 2025-09-03: パフォーマンス最適化モジュール実装
- 2025-09-03: セキュリティ強化モジュール実装
- 2025-09-03: ES6 modules対応完了
- 2025-09-03: イベントカード全体クリック機能実装
- 2025-09-03: フッター重複問題修正、デザイン統一完了
- 2025-09-03: フッター文字配置の統一（中央揃え→左揃え）完了

## 重要な設計決定
1. **アーキテクチャ**: モジュラー設計、コンポーネントベース
2. **パフォーマンス**: デバウンス、パッシブイベントリスナー、Intersection Observer
3. **セキュリティ**: エラーハンドリング、入力検証、セキュアな実装パターン
4. **アクセシビリティ**: WCAG 2.1 AA準拠、キーボードナビゲーション
5. **保守性**: 自己文書化コード、モジュラー設計、一貫したコーディング規約
6. **UI/UX**: 統一されたデザインシステム、一貫したフッター設計
7. **ユーザビリティ**: イベントカード全体クリック機能、直感的な操作

## 実装履歴（続き）
- 2025-09-03: イベントホーム画面のヒーロー画像実装完了
  - 指定画像URL: https://images.pinyogram.com/home/0916.png
  - プリロード機能追加でパフォーマンス向上
  - エラーハンドリングとフォールバック機能実装
  - レスポンシブ対応とスムーズな画像切り替え実装
- 2025-09-03: ヒーロー画像の全幅ぼかし背景実装完了
  - 40:21アスペクト比でCLS防止
  - 100vw全幅ぼかし背景で左右のページ背景色を隠蔽
  - 動的な背景URL設定でスライド切替に対応
  - レスポンシブ対応（デスクトップ40:21、タブレット16:9、モバイル4:3）
  - 既存UI（角丸、オーバーレイ、スライダー）を完全維持
- 2025-09-03: ヒーロー/カード画像の「迷い込み」と下余白修正完了
  - グローバル.overlay指定を撤回し、.media-overlayにスコープ化
  - 画像ラッパーの高さをaspect-ratio:40/21に統一
  - 画像下の余白を完全除去（display:block + line-height:0）
  - HTML構造を.media-frameに統一（既存クラスとの互換性維持）
  - 既存のぼかし背景を.has-blurクラスで管理
- 2025-09-03: ヒーロー画像サイズ調整完了
  - アスペクト比を40:21から16:9に変更（より適切なサイズ）
  - デスクトップ最大高さ400pxに制限
  - モバイル（768px以下）最大高さ300pxに制限
  - 小型スマートフォン（480px以下）最大高さ250pxに制限
  - レスポンシブ対応で全デバイスで適切なサイズ表示
- 2025-09-03: ヒーロー画像とカード・カレンダーの重なり修正完了
  - メインコンテナの上部マージンを削除して重なりを解消
  - ヒーローセクションのマージンを60pxに拡大
  - z-indexを適切に設定（ヒーローセクション: 2, ヒーローバンド: 1, メインコンテナ: 1）
  - レスポンシブ対応で全デバイスで適切な間隔を確保
- 2025-09-03: グローバル.overlay指定とスタックコンテキスト混線修正完了
  - グローバル.overlay指定を完全無効化（position: static, inset: auto）
  - height直指定を削除してaspect-ratio:40/21に一本化
  - 画像ラッパーにisolation:isolateとoverflow:hiddenを追加
  - HTML構造を.media-frame is-40x21 fill-gradientに統一
  - 競合除去（.hero img, .hero figure { height: auto !important; }）
  - 全デバイスで40:21比率に統一、スタックコンテキスト分離完了
- 2025-09-03: ヒーロー画像と他のセクションの重なり完全解消完了
  - ヒーローセクションのz-indexを10に強化、margin-bottomを80pxに拡大
  - メインコンテナのz-indexを1に設定、clear:bothとmargin-top:0を追加
  - カレンダーセクションのposition:stickyをrelativeに変更
  - 全セクションにposition:relativeとz-index:1を設定
  - レスポンシブ対応で全デバイスで重なりを完全解消
  - ヒーローバンドにmargin-bottom:20pxを追加して間隔を確保
- 2025-09-03: ヒーロー画像のセクション収納問題完全解決完了
  - ヒーローセクション全体に固定高さ400pxを設定
  - 全コンテナ（hero-container, hero-slider, hero-slide）に固定高さ400pxを設定
  - 画像のobject-fitをcoverに変更してコンテナを完全に埋める
  - overflow:hiddenを全レベルで設定してはみ出しを完全防止
  - メインコンテナのmargin-topを80pxに設定して適切な間隔を確保
  - セクション境界を明確に定義して画像が確実に収まるよう修正
- 2025-09-03: fill-gradient機能実装完了
  - Media Frame共通CSSをshared/style.cssとevent/css/shared/style.cssに追加
  - ヒーロー画像(1200×630=40:21)を切らずに表示する機能実装
  - 左右/上下の余白を画像由来の自動2色グラデで自然に埋める機能実装
  - 角丸・帯UIをラッパ内に閉じ込める機能実装
  - 自動2色抽出JSをevent/index.htmlに追加
  - 既存DOM構造を維持しながら新しいクラス構成に変更
  - リサイズしても崩れないレスポンシブ対応完了
- 2025-09-03: ヒーロー画像表示方式調整完了
  - object-fitをcontainからcoverに変更して画像全体が映るように調整
  - 両CSSファイル（shared/style.css、event/css/shared/style.css）で一貫した設定を適用
  - 40:21アスペクト比を維持しながら画像全体を表示
- 2025-09-03: ヒーロー画像下部欠け問題修正完了
  - object-positionをcenterからbottomに変更して画像下部が表示されるように調整
  - 両CSSファイルで一貫した設定を適用
  - 画像の下部が適切に表示されるように修正
- 2025-09-03: ヒーロー画像contain固定＋No-Overlap ガード実装完了
  - Media Frame共通CSSをNo-Overlap ガード付きバージョンに更新
  - 画像を常にobject-fit: containで全体表示（上下も左右もトリミングしない）
  - ヒーローの内容（帯UIなど）が必ずヒーロー内に収まるようoverflow: clipで制御
  - ヒーローが他セクションに被らないようisolation: isolateで積層文脈を分離
  - 旧グローバル.overlayやheight直指定の副作用を無効化
  - ヒーローセクションをno-overlapクラス付きの簡潔な構造に変更
  - 自動2色抽出JSを最適化版に更新
  - aspect-ratio: 40/21によりCLS悪化を防止
- 2025-09-03: ヒーロー画像サイズ25%縮小完了
  - aspect-ratioを40/21から30/21（10:7）に変更して25%縮小
  - 両CSSファイル（shared/style.css、event/css/shared/style.css）で一貫した設定を適用
  - 画面を占める割合を適切に調整してヒーロー画像のサイズを最適化
- 2025-09-03: ヒーロー画像縮小反映問題修正完了
  - 既存のCSS設定（.hero-section、.hero-container、.hero-slider、.hero-band）が新しい設定を上書きしていた問題を発見
  - 固定高さを400pxから300pxに変更（25%縮小）
  - 最大高さを500pxから375pxに変更（25%縮小）
  - レスポンシブ設定でもaspect-ratio: 40/21を30/21に一括変更
  - 既存の競合する設定をすべて更新して縮小を確実に反映
- 2025-09-03: ヒーロー画像サイズ変更を元に戻し完了
  - aspect-ratioを30/21から40/21に戻す
  - 固定高さを300pxから400pxに戻す
  - 最大高さを375pxから500pxに戻す
  - すべての設定を元の状態に復元
- 2025-09-03: ヒーロー画像構造分離完了
  - ヒーロー画像専用のCSSクラスを作成（.hero-section配下に限定）
  - 既存のグローバル設定をヒーロー専用に分離
  - 他のセクションへの影響を完全に遮断
  - CSS変数（--hero-aspect-ratio、--hero-height、--hero-max-height）を導入
  - ヒーロー画像のサイズ変更を安全に実行できる構造に整理
  - 変数変更のみで全ヒーロー要素のサイズを一括変更可能
- 2025-09-03: ヒーロー統一版実装完了
  - 比率の誤りを修正（30/21 → 40/21）
  - 旧ヒーロー定義（hero-sectionブロック）を完全削除
  - ヒーロー統一版（.hero.no-overlap + .media-frame.fill-gradient）を実装
  - 自然な高さを変数で管理（--hero-h-sm、--hero-h-md、--hero-h-lg）
  - 見切れないcontain固定（aspect-ratio: auto !important）
  - 他セクションへの非侵食（isolation: isolate + overflow: clip）
  - 余分な}を削除してコードを整理
- 2025-09-03: ヒーロー用最小セット実装完了
  - 共通CSSにヒーロー用の最小セット（.hero-shell / .hero-frame）を追加
  - セクション幅は横いっぱいにしない（中央寄せ・最大幅は可変）
  - 画像はデフォルトで切れないcontain、枠はアスペクト比に追従
  - 既存HTMLのヒーローDOMを新しい構造に置換
  - 旧グローバル.overlayの副作用を無効化
  - 2色自動抽出JSは既に実装済み
  - セクションのサイズ調整と画像の見せ方を完全に分離
- 2025-09-03: ヒーローセクション20%縮小・中央配置修正完了
  - ヒーローセクションのサイズを20%縮小（最大幅1100px→880px）
  - プリセットクラスも20%縮小（sm: 704px, md: 880px, lg: 1024px）
  - 中央配置を確実にするためmargin-left/right: autoを明示的に指定
  - body要素にtext-align: centerを追加して子要素の中央配置を確実にする
  - ヒーローセクション内のテキストは左寄せ、メインコンテナも左寄せに設定
  - 右側の空白が大きくなる問題を解決
- 2025-09-03: ヒーローセクション追加25%縮小・中央配置完全修正完了
  - ヒーローセクションのサイズをさらに25%縮小（最大幅880px→660px）
  - プリセットクラスも25%縮小（sm: 528px, md: 660px, lg: 768px）
  - Flexboxを使用した確実な中央配置を実装（display: flex, justify-content: center）
  - ヒーローフレームにflex: 0 0 autoを追加してFlexbox内で適切に動作
  - 中央配置のずれ問題を完全に解決
- 2025-09-03: 画像だけ縮小システム実装完了
  - 共通CSSに「画像だけ縮小」の仕組みを追加（transform: scale使用）
  - CSS変数（--img-scale）でスケールを管理
  - ユーティリティクラス（img-75, img-50, img-90）を追加
  - ヒーローのHTMLにimg-75クラスを追加して25%縮小を適用
  - 既存のobject-fit: containとobject-position: centerを維持
  - レイアウトや他セクションに影響しない描画のみの縮小
- 2025-09-03: 画像縮小システムの優先度修正・サーバー再起動完了
  - 既存の.hero-frame>imgスタイルにtransformプロパティを統合
  - 重複するCSSルールを削除して競合を解消
  - より具体的なセレクター（.hero-frame.img-75）で優先度を向上
  - CSSバージョンをv10.0.0に更新してキャッシュをクリア
  - ローカルサーバーを再起動して変更を確実に反映
- 2025-09-03: ヒーロー画像のさらなる25%縮小完了
  - img-75クラス（75%表示）からimg-50クラス（50%表示）に変更
  - 合計50%縮小（元のサイズの半分）を実現
  - 画像の中央配置とアスペクト比は維持
- 2025-01-27: ヒーロー画像のデフォルトサイズ調整完了
  - デフォルトの--img-scaleを1から0.8に変更（20%縮小）
  - 現在の比率を維持したまま適度なサイズに調整
  - shared/css/style.cssとevent/css/shared/style.cssの両方を更新
- 2025-01-27: コスプレ撮影会SPイベント完全削除完了
  - data/events.jsonからEVT003（コスプレ撮影会SP）を削除
  - pinyogram-lp/photo-session-connect/data/events.jsonからEVT003を削除
  - event/event-detail.htmlからEVT003のイベントデータと関連イベントを削除
  - event/EVT003/index.htmlとディレクトリを削除
  - デフォルトイベントIDをEVT004に変更
- 2025-01-27: ヘッダーレスポンシブ対応（ハンバーガーメニュー）実装完了
  - ヘッダーHTMLにハンバーガーメニューボタンを追加
  - CSSで768px以下でハンバーガーメニューを表示
  - JavaScriptでメニューの開閉機能を実装
  - アクセシビリティ対応（aria-expanded、キーボード操作、ESCキー）
  - メニューリンククリック時の自動閉じ機能
  - 画面サイズ変更時の自動メニュー閉じ機能

## 次のアクション
1. アーキテクチャ最適化の実行
2. パフォーマンス最適化の実装
3. セキュリティ強化の適用
4. コード品質向上の実装
